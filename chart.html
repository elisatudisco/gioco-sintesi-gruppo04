<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Leaderboard</title>

    <script src="libraries/p5.min.js"></script>
    <script src="libraries/p5.serialport.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://use.typekit.net/cwg3cvo.css"> <!--Loos font-->
</head>

<body>
    <div id="testo">
        <div id="demo"></div>
        <div id="carnesintetica"></div>
    </div>

    <div id="titolo">
        <div id="titolone">Leaderboard</div>
    </div>

    <script>
        const urlString = window.location.href;
        const url = new URL(urlString);

        BIN_ID = '6385e5b3a3c728450eda7d89';
        API_KEY = '$2b$10$KWxVu8aW.YRXOvS0UwlDP.hS6u52PsWX9b69W6JfL6fvdiXoXqqde';

        let req = new XMLHttpRequest();

        req.onreadystatechange = () => {
            if (req.readyState == XMLHttpRequest.DONE) {
                function bubbleSort(arr) {
                    var len = arr.length;
                    for (var i = len - 1; i >= 0; i--) {
                        for (var j = 1; j <= i; j++) {
                            if (arr[j - 1] < arr[j]) {
                                var temp = arr[j - 1];
                                arr[j - 1] = arr[j];
                                arr[j] = temp;
                            }
                        }
                    }
                    return arr;
                }
                let data = JSON.parse(req.responseText).record;
                let leaderboard = data.leaderboard;
                leaderboard = bubbleSort(leaderboard);

                let pillola = JSON.stringify(leaderboard);
                let pillolina = pillola.replace(/\[|\]|\{|\}|"|polpettona|:/g, '')
                let micropillola = pillolina.split(",")
                micropillola = bubbleSort(micropillola)
                localStorage.setItem('test2', micropillola);
            }
        };

        let pillolina1
        let micropillola1
        let lollobrigidaseimitica = ''
        let ciccia = [];
        let ciccina;
        let cicciolina;
        let pongo = 1;
        let gigafluffodoggus = 0;
        let chickpea;

        function setup() {
            pillolina1 = localStorage.getItem('test2');

            if (pillolina1 == null) {
                lollobrigidaseimitica = " "
                document.getElementById("carnesintetica").innerHTML = lollobrigidaseimitica;
                gigafluffodoggus = 1;
            }

            if (gigafluffodoggus == 1) {
                return
            }
            else {
                micropillola1 = pillolina1.split(",");
            }

            if (gigafluffodoggus == 1) {
                return
            }
            else {
                const chartContainer = document.getElementById("demo");
                while (chartContainer.hasChildNodes()) { chartContainer.removeChild(chartContainer.lastChild); }
                micropillola1.forEach(element => {

                    let tmp = document.createElement('div');
                    tmp.classList.add('chart__item');
                    tmp.innerHTML = pongo + "Â°" + " " + element;
                    chartContainer.appendChild(tmp);
                    pongo++;
                });
            }

            console.log(pillolina1);
            chickpea = pillolina1.replace(/a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z| |'|/g, '')
            let chickpea1 = chickpea.split(",");

            let sum = 0;
            chickpea1.forEach(item => {
                let antonio = Number(item);
                sum += antonio;
            });

            console.log(sum);
            localStorage.setItem('somma', sum);
        }

        function draw() {
        }

        req.open("GET", `https://api.jsonbin.io/v3/b/${BIN_ID}`, true);
        req.setRequestHeader("X-Master-Key", API_KEY);
        req.send();

        function keyPressed() {
            if (key === "c") {
                localStorage.clear();
            }
        }

        function keyPressed() {
            if (keyCode === ENTER) {
                window.open('qrcode.html', '_self');
            }
        }

        setTimeout(function () {
            if (window.location.hash != '#r') {
                window.location.hash = 'r';
                window.location.reload(1);
            }
        }, 500);
    </script>
</body>

</html>